{% extends "base.html" %}
{% block content %}
<div class="container" style="max-width: 1200px; margin: 0 auto; padding: 20px;">
    <center><h2>Peer Review Results</h2></center>
    <br>
    
    {% if not all_completed %}
    <div style="background: #fff3cd; border: 1px solid #ffeeba; border-radius: 10px; padding: 20px; margin-bottom: 20px; color: #856404; text-align: center;">
        <h4>Waiting for submissions...</h4>
        <p>Results will be available once all 4 students have completed their peer reviews and self-assessments.</p>
    </div>
    {% endif %}
    
    <div style="background: #fff; border: 1px solid #ddd; border-radius: 10px; padding: 20px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
        <table class="results-table" style="width: 100%; border-collapse: collapse; text-align: center;">
            <thead style="background-color: #f8f9fa;">
                <tr>
                    <th style="padding: 10px; border: 1px solid #ddd;">Student</th>
                    {% if all_completed %}
                        <th style="padding: 10px; border: 1px solid #ddd;">Avg Peer Score</th>
                    {% endif %}
                    <th style="padding: 10px; border: 1px solid #ddd;">Peer Comments</th>
                </tr>
            </thead>
            <tbody>
                {% for row in rows %}
                <tr>
                    <td style="padding: 10px; border: 1px solid #ddd;"><strong>{{ row.student_name }}</strong></td>
                    {% if all_completed %}
                        <td style="padding: 10px; border: 1px solid #ddd;">
                            {% if row.avg_peer_score is not none %}
                                <span style="color: #28a745; font-weight: bold;">{{ row.avg_peer_score }}/5</span>
                            {% else %}
                                <em style="color: #999;">N/A</em>
                            {% endif %}
                        </td>
                    {% endif %}
                    <td style="padding: 10px; border: 1px solid #ddd; text-align: left; max-width: 400px;">
                        {% if row.peer_comments %}
                            {% for comment in row.peer_comments %}
                                <div style="margin-bottom: 10px; padding: 8px; background: #f8f9fa; border-left: 3px solid #007bff; border-radius: 4px;">
                                    <strong>{{ comment.reviewer }}:</strong> {{ comment.comment }}
                                </div>
                            {% endfor %}
                        {% else %}
                            {% if current_user == row.student_name and all_completed %}
                                <em style="color: #999;">No comments received from peers.</em>
                            {% elif current_user == row.student_name %}
                                <em style="color: #999;">Comments will appear here once all reviews are completed.</em>
                            {% else %}
                                <em style="color: #999;">Comments are private to each student.</em>
                            {% endif %}
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Navigation Buttons -->
    <div style="text-align: center; margin-top: 30px;">
        <form action="{{ url_for('form') }}" style="display: inline;">
            <button type="submit" class="btn btn-secondary" 
                    style="background: #6c757d; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px;">
                Edit Reviews
            </button>
        </form>
        
        <form action="{{ url_for('dashboard') }}" style="display: inline;">
            <button type="submit" class="btn btn-primary"
                    style="background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px;">
                Back to Dashboard
            </button>
        </form>

        <form action="{{ url_for('index') }}" style="display: inline;">
            <button type="submit" class="btn btn-success"
                    style="background: #28a745; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px;">
                Start Over
            </button>
        </form>
    </div>
</div>
{% endblock %}