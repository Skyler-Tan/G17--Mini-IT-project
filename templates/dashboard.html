{% extends "base.html" %}
{% block content %}
<div class="container" style="max-width: 800px; margin: 0 auto; padding: 20px;">
    <center><h2>Peer Review Dashboard</h2></center>
    <br>

    <!-- Students Section -->
    <div style="background: #fff; border: 1px solid #ddd; border-radius: 10px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
        <h3 style="margin-bottom: 20px; color: #333;">Students</h3>
        
        {% for student in students %}
        <div style="display: flex; align-items: center; margin-bottom: 15px;">
            <!-- Student Button -->
            <a href="{{ url_for('switch_user_and_form', username=student.replace(' ', '_')) }}" 
               style="text-decoration: none;">
                <div style="background: #f8f9fa; border: 2px solid #333; border-radius: 15px; padding: 15px 20px; width: 200px; text-align: center; cursor: pointer; transition: all 0.3s;">
                    <strong style="color: #333;">{{ student }}</strong>
                </div>
            </a>
            
            <!-- Completion Checkmark -->
            <div style="margin-left: 20px;">
                {% if completion_status[student] %}
                    <svg width="30" height="30" style="color: #28a745;">
                        <path d="M5 15 L12 22 L25 8" stroke="#28a745" stroke-width="3" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                {% else %}
                    <div style="width: 30px; height: 30px; border: 2px solid #ddd; border-radius: 50%; background: #f8f9fa;"></div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Teacher Section -->
    <div style="background: #e8f4fd; border: 2px solid #0066cc; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
        <h3 style="color: #0066cc; margin-bottom: 15px;">
            <svg width="20" height="20" style="margin-right: 10px; vertical-align: middle;">
                <rect width="20" height="15" fill="#0066cc"/>
                <rect x="2" y="2" width="16" height="11" fill="white"/>
            </svg>
            Teacher Controls
        </h3>
        
        <form method="POST" action="{{ url_for('teacher_input') }}">
            <div style="display: flex; gap: 20px; align-items: end;">
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Group Mark (0-100):</label>
                    <input type="number" name="group_mark" min="0" max="100" step="0.1" 
                           value="{{ teacher_marks.group_mark if teacher_marks else '' }}" 
                           style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 120px;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Rating (1-5):</label>
                    <input type="number" name="rating" min="1" max="5" step="0.1" 
                           value="{{ teacher_marks.rating if teacher_marks else '' }}" 
                           style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 120px;">
                </div>
                <button type="submit" style="background: #0066cc; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer;">
                    Save Marks
                </button>
            </div>
        </form>
        
        {% if teacher_marks %}
        <div style="margin-top: 10px; padding: 10px; background: rgba(40, 167, 69, 0.1); border-left: 4px solid #28a745; border-radius: 4px;">
            <small style="color: #28a745;">
                ✓ Teacher marks saved: Group Mark = {{ teacher_marks.group_mark }}%, Rating = {{ teacher_marks.rating }}/5
            </small>
        </div>
        {% endif %}
    </div>

    <!-- Results Preview -->
    <div style="background: #fff; border: 1px solid #ddd; border-radius: 10px; padding: 20px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
        <h3 style="margin-bottom: 15px;">Results Preview</h3>
        
        {% if all_students_completed %}
            {% if teacher_marks %}
                <!-- Show full results -->
                <div style="color: #28a745; margin-bottom: 15px;">
                    <strong>✓ All requirements met - Final results available!</strong>
                </div>
                
                <table style="width: 100%; border-collapse: collapse;">
                    <thead style="background: #f8f9fa;">
                        <tr>
                            <th style="padding: 10px; border: 1px solid #ddd;">Student</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">Avg Peer Score</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">Final Mark</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for result in results %}
                        <tr>
                            <td style="padding: 10px; border: 1px solid #ddd;"><strong>{{ result[0] }}</strong></td>
                            <td style="padding: 10px; border: 1px solid #ddd; color: #28a745;">{{ result[1] }}/5</td>
                            <td style="padding: 10px; border: 1px solid #ddd; color: #dc3545; font-weight: bold;">{{ result[2] }}%</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                
                <div style="text-align: center; margin-top: 20px;">
                    <a href="{{ url_for('results') }}" 
                       style="background: #28a745; color: white; padding: 12px 24px; text-decoration: none; border-radius: 4px; font-weight: bold;">
                        View Detailed Results
                    </a>
                </div>
            {% else %}
                <!-- Show peer averages only -->
                <div style="color: #ffc107; margin-bottom: 15px;">
                    <strong>⚠️ All students completed reviews - Waiting for teacher marks</strong>
                </div>
                
                <table style="width: 100%; border-collapse: collapse;">
                    <thead style="background: #f8f9fa;">
                        <tr>
                            <th style="padding: 10px; border: 1px solid #ddd;">Student</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">Avg Peer Score</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">Final Mark</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for result in results %}
                        <tr>
                            <td style="padding: 10px; border: 1px solid #ddd;"><strong>{{ result[0] }}</strong></td>
                            <td style="padding: 10px; border: 1px solid #ddd; color: #28a745;">{{ result[1] }}/5</td>
                            <td style="padding: 10px; border: 1px solid #ddd; color: #999;">
                                <em>Pending teacher marks</em>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% endif %}
        {% else %}
            <div style="color: #dc3545; text-align: center; padding: 20px;">
                <strong>⏳ Waiting for all students to complete their reviews</strong>
                <br>
                <small style="color: #666;">
                    Completed: {{ completed_count }}/{{ total_students }} students
                </small>
            </div>
        {% endif %}
    </div>

    <!-- Navigation -->
    <div style="text-align: center; margin-top: 20px;">
        <a href="{{ url_for('results') }}" 
           style="background: #6c757d; color: white; padding: 10px 20px; text-decoration: none; border-radius: 4px; margin: 5px;">
            Advanced Results View
        </a>
        <a href="{{ url_for('view_db') }}" 
           style="background: #17a2b8; color: white; padding: 10px 20px; text-decoration: none; border-radius: 4px; margin: 5px;">
            View Database
        </a>
    </div>
</div>

<style>
/* Hover effects for student buttons */
a div:hover {
    background: #e9ecef !important;
    border-color: #007bff !important;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
}
</style>
{% endblock %}