{% extends "layout.html" %}
{% block content %}
<h2>Students</h2>

<form method="post" class="card">
  <div class="grid">
    <div>
      <label>First Name</label>
      <input name="first_name" required>
    </div>
    <div>
      <label>Last Name</label>
      <input name="last_name" required>
    </div>
    <div>
      <label>Email</label>
      <input name="email" type="email" required>
    </div>
    <div>
      <label>Username</label>
      <input name="username" required>
    </div>
    <div>
      <label>Password</label>
      <input name="password" type="password" required>
    </div>
    <div>
      <label>Subject (optional)</label>
      <select name="subject_id">
        <option value="">— None —</option>
        {% for subj in subjects %}
          <option value="{{ subj.id }}">{{ subj.name }}</option>
        {% endfor %}
      </select>
    </div>
    <div>
      <label>Group (optional)</label>
      <select name="group_id">
        <option value="">— None —</option>
        {% for g in groups %}
          <option value="{{ g.id }}">{{ g.name }} (subject {{ g.subject_id }})</option>
        {% endfor %}
      </select>
    </div>
  </div>
  <button type="submit">Add Student</button>
</form>

<table>
  <thead><tr><th>ID</th><th>Name</th><th>Email</th><th>Username</th><th>Subject</th><th>Group</th><th>Actions</th></tr></thead>
  <tbody>
    {% for s in students %}
      <tr>
        <td>{{ s.id }}</td>
        <td>{{ s.first_name }} {{ s.last_name }}</td>
        <td>{{ s.email }}</td>
        <td>{{ s.username }}</td>
        <td>{{ s.subjects|length }}</td>
        <td>
          {% for m in s.memberships %}
            {{ m.group.name }}<br>
          {% endfor %}
        </td>
        <td>
          <form method="post" action="{{ url_for('delete_student', student_id=s.id) }}" onsubmit="return confirm('Remove student?');">
            <button type="submit">Delete</button>
          </form>
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}